<?xml version="1.0" encoding="utf-8"?>
<!--
  Shared props file for linking JNI libraries into shared libraries (.so).

  JNI entry points are called by Java, not C++, so they have no C++ references and
  would normally be stripped when linking a static library into a shared library.
  This file uses linker flags to force-include all symbols from the JNI library.

  Usage:
    1. Set the OceanJniLibraryName property to your JNI library name (without Debug/Release suffix)
    2. Import this file with the appropriate condition

  Example in your *jni_use.props:
    <PropertyGroup>
      <OceanJniLibraryName>OceanBaseJni</OceanJniLibraryName>
    </PropertyGroup>
    <Import Condition="'$(ocean_jni_library_common_imported)' != 'True'" Project="..\..\ocean_jni_library_common.props"/>
-->
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <_PropertySheetDisplayName>Ocean JNI Library Linking (Android)</_PropertySheetDisplayName>
  </PropertyGroup>

  <PropertyGroup>
    <ocean_jni_library_common_imported>True</ocean_jni_library_common_imported>
  </PropertyGroup>

  <!-- Validate that OceanJniLibraryName is set -->
  <Target Name="_ValidateJniLibraryName" BeforeTargets="Link">
    <Error Condition="'$(OceanJniLibraryName)' == ''"
           Text="OceanJniLibraryName property must be set before importing ocean_jni_library_common.props" />
  </Target>

  <!-- Link against debug JNI library with whole-archive -->
  <ItemDefinitionGroup Condition="$(Configuration.Contains('Debug'))">
    <Link>
      <AdditionalOptions>-Wl,--whole-archive -l$(OceanJniLibraryName)D -Wl,--no-whole-archive %(AdditionalOptions)</AdditionalOptions>
    </Link>
  </ItemDefinitionGroup>

  <!-- Link against release JNI library with whole-archive -->
  <ItemDefinitionGroup Condition="!$(Configuration.Contains('Debug'))">
    <Link>
      <AdditionalOptions>-Wl,--whole-archive -l$(OceanJniLibraryName) -Wl,--no-whole-archive %(AdditionalOptions)</AdditionalOptions>
    </Link>
  </ItemDefinitionGroup>
</Project>
